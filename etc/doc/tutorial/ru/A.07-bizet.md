A.7 Bizet Beats

# Ритмы Бизе

После нашего краткого экскурса в сказочный мир кодинга Minecraft в прошлом
месяце, давайте снова помузицируем. Сегодня мы собираемся перенести
классический оперный танцевальный ритм в 21-й век, используя грандиозную силу
кода.

## Возмутительно И Дерзко

Переместимся на машине времени в 1875 год. Композитор Бизе как раз закончил
свою последнюю оперу "Кармен". К сожалению, как и множество других
прогрессивных, ломающих стереотипы музыкальных произведений, публика поначалу
её не приняла, ведь она была слишком дерзкой и непохожей на другие оперы того
времени. Печально, но Бизе умер за десять лет до того, как эта опера заработала
ошеломляющий международный успех и стала одной из самых известных и часто
исполняемых опер всех времён. Из сочувствия к этой трагедии, возьмем одну из
главных тем оперы "Кармен", и преобразуем её в современный формат музыки,
который также слишком возмутителен и чужд большинству людей нашего времени -
кодированную музыку!

## Расшифровка Хабанеры

Пытаться кодировать всю оперу было бы сложноватой задачей для одной статьи,
так что давайте сосредоточимся на одной из самых известных её частей - басовой
партии Хабанеры:

![Habanera Riff](../images/tutorial/articles/A.07-bizet/habanera.png)

Если вы ещё не изучали нотной записи, это будет выглядеть крайне непонятным для
вас. Однако, как программисты, мы видим нотную запись просто как другую форму
кода, содержащего инструкции не для компьютера, а для музыканта. Поэтому нам
нужно найти способ декодировать его. 

## Ноты

Ноты упорядочиваются слева направо, как слова в этой статьи, но имеют разную
высоту. *Высота относительно нотной партитуры обозначает высоту тона.* Чем выше
нота находится в партитуре, тем выше высоты тона.

Мы уже знаем, как изменить высоту ноты в Sonic Pi  - либо используя цифры,
такие как `play 75` и `play 80`, либо используя названия нот: `play :Е` и
`play :F`. К счастью, каждой вертикальной позиции музыкальной партитуры
соответствует определенная нота. Взгляните на эту удобную таблицу:

![Notes](../images/tutorial/articles/A.07-bizet/notes.png)

## Паузы

Ноты представляют собой чрезвычайно богатый и выразительный вид кода,
способного объединить сразу множество вещей. Поэтому дя вас не должно стать
большим удивлением, что партитура может не только сказать вам, какие ноты
играть, но также когда ноты играть *не* нужно . В программировании это
эквивалентно `nil` или `null` - отсутствию значения. Другими словами, пауза -
это отсутствие ноты.

Если вы внимательно посмотрите на партитуру, вы увидите, что это на самом деле 
сочетание горизонтальных линий с черными точками, которые представляют собой
ноты, коротые нужно играть, и волнистых штук, которые представляют собой
паузы. К счастью, Sonic Pi имеет очень удобное представление для пауз: `:r`,
так, если мы выполним: `play :r`, он на самом деле сыграет тишину! Мы могли бы
также написать `play :rest`, `play nil` или `play false` - это всё
эквивалентные способы представления пауз.

## Ритм

Наконец, нужно узнать ещё одну вещь - как расшифровывать в партитуре
длительности нот. В оригинальной партитуре мы видим, что ноты связаны толстыми
линиями, называемыми рёбрами. Вторая нота имеет два таких ребра, что означает,
что она длится 16-ю часть такта. Другие ноты имеют одно ребро, которое
означает, что они дляться 8-ю часть такта. Паузы имеют два волнистых флажка,
которые означают, что они также длятся 16-ю часть такта.

Когда мы пытаемся расшифровать и изучить новые вещи, очень удобный приём - 
сделать всё как можно более однородным, чтобы увидеть соотношения и структуры.
Например, если мы перепишем нашу партитуру одними только 16-ми длительностями,
вы сможете увидеть, что она превращается в простую последовательность нот и
пауз.

![Habanera Riff 2](../images/tutorial/articles/A.07-bizet/habanera2.png)

## Повторное кодирование Хабанеры

Теперь мы в состоянии начать переводить эту басовую партию для Sonic Pi.
Давайте закодируем эти ноты и паузы в кольцо:


    (ring :d, :r, :r, :a, :f5, :r, :a, :r)


Теперь посмотрим, как это звучит. Закиньте это кольцо в живой цикл, чтобы можно
было последовательно извлекать элементы кольца:


    live_loop :habanera do
      play (ring :d, :r, :r, :a, :f5, :r, :a, :r).tick
      sleep 0.25
    end


Легендарный, мгновенно узнаваемый рифф возвращается к жизни сквозь ваши
колонки. Потребовалось немало усилий, чтобы добраться сюда, но это того стоило!
    
## Мрачные Синты

Теперь у нас есть басовая партия. Давайте воссоздадим атмосферу оперной сцены.
Попробуем осуществить это с `:blade`, мрачным солирующим синтом в стиле 80-х.
Давайте испробуем его, извлекая ноту `:d`, пропущенную через эффекты нарезки и
реверберации:


    live_loop :habanera do
      use_synth :fm
      use_transpose -12
      play (ring :d, :r, :r, :a, :f5, :r, :a, :r).tick
      sleep 0.25
    end

    with_fx :reverb do
      live_loop :space_light do
        with_fx :slicer, phase: 0.25 do
          synth :blade, note: :d, release: 8, cutoff: 100, amp: 2
        end
        sleep 8
      end
    end


Теперь, попробуйте подставить туда другие ноты басовой партии:`:a` и `:f5`.
Помните, вам не надо нажимать кнопку "Остановить", просто измените код в то
время, как музыка играет, и нажмите "Выполнить" снова. Также, попробуйте разные
значения параметра `phase:` нарезки, такие как `0.5`, `0.75` и `1`.

## Соберём Всё Вместе

Наконец, давайте объединим все идеи этой статьи в новый ремикс Хабанеры. Вы
можете заметить, что я включил ещё одну часть басовой партии как комментарий.
Как только вы набрали всё это в буфере, нажмите "Выполнить", чтобы прослушать
композицию. Затем, не нажимая кнопку "Остановить", *раскомментируйте* вторую
строку, удалив знак `#`, и нажмите "Выполнить" снова - как это удивительно!
Итак, начинайте лайвкодинг и веселитесь!

    use_debug false
    bizet_bass = (ring :d, :r, :r, :a, :f5, :r, :a, :r)
    #bizet_bass = (ring :d, :r, :r, :Bb, :g5, :r, :Bb, :r)
     
    with_fx :reverb, room: 1, mix: 0.3 do
      live_loop :bizet do
        with_fx :slicer, phase: 0.125 do
          synth :blade, note: :d4, release: 8,
            cutoff: 100, amp: 1.5
        end
        16.times do
          tick
          play bizet_bass.look, release: 0.1
          play bizet_bass.look - 12, release: 0.3
          sleep 0.125
        end
      end
    end
     
    live_loop :ind do
      sample :loop_industrial, beat_stretch: 1,
        cutoff: 100, rate: 1
      sleep 1
    end
     
    live_loop :drums do
      sample :bd_haus, cutoff: 110
      synth :beep, note: 49, attack: 0,
        release: 0.1
      sleep 0.5
    end
